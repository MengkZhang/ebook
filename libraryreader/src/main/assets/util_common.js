var taskIds=[];var prefStyleId="achellies_android_pref_style";var Delay={NONE:0,CHAPTER_READY:10,CSS_LOAD:60,PRE_PAGINATE:60,CONTENT_READY:60,FINISH_LOAD:100,SHORT:100,LONG:3000};var ViewportConstants={EXTRA_MARGIN:1,CM_IN_INCH:2.54,MM_IN_INCH:25.4,POINTS_IN_INCH:72,PICAS_IN_INCH:6};var NUMBER_REG_EXP=/[-+]?[0-9]*\.?[0-9]+/;function clearPendingTasks(){if(taskIds.length!=0){for(var b=0,a;a=taskIds[b];b++){window.clearTimeout(a)}taskIds.length=0}}function scheduleTask(b,a){taskIds.push(window.setTimeout(b,a))}function isDef(a){return typeof a!="undefined"}function isString(a){return typeof a=="string"}function isInt(a){return typeof a=="number"&&a%1==0}function $get(a){return document.getElementById(a)||null}function createElementWithClass(d,b,c){var a=d.createElement(b);if(isDef(c)){a.className=c}return a}function createElementWithIdAndClass(d,b,e,c){var a=createElementWithClass(d,b,c);if(isDef(e)){a.id=e}return a}function bind(b,c){var a=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.slice.call(arguments);d.unshift.apply(d,a);return b.apply(this,d)}}function createCssLink(c,a){var b=c.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=a;return b}function createStyleElement(c,b,d){var a=c.createElement("style");a.type="text/css";a.textContent=b;if(d){a.id=d}return a}function createJavascriptLinkElement(b,c){var a=b.createElement("script");a.language="javascript";a.type="text/javascript";a.src=c;return a}function getHeadElement(a){return a.getElementsByTagName("HEAD")[0]}function appendOrReplaceNode(c,b,a){if(a){c.replaceChild(b,a)}else{c.appendChild(b)}}function createNodeIterator(b,a){return b.ownerDocument.createNodeIterator(b,a,null,false)}function removeTagsFromParent(a,b){var c=a.getElementsByTagName(b);while(c.length>0){a.removeChild(c.item(0))}}function emptyCallback(){}function Stopwatch(b){this.enabled_=b;if(this.enabled_){var a=new Date();this.startTime=a.getTime()}}Stopwatch.prototype.getElapsedMillis=function(){if(this.enabled_){var a=new Date();return a.getTime()-this.startTime}else{return 0}};function NumberWithUnit(b,a){this.value=b;this.unit=a}function parseCssNumber(c){if(c&&c.length>0){var d=NUMBER_REG_EXP.exec(c);if(d&&(d.length==1)){var a=d[0];var b=c.substring(c.indexOf(a)+a.length);return new NumberWithUnit(parseFloat(a),b)}}return null}function Pair(b,a){this.first=b;this.second=a}function comparePairsByFirstNumber(d,c){return d.first-c.first}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)}function startsWith(b,a){return b.lastIndexOf(a,0)==0}function endsWith(b,a){return b.indexOf(a,b.length-a.length)!==-1}function Rect(d,c,b,a){this.set(d,c,b,a)}Rect.prototype.set=function(d,c,b,a){this.left=d;this.top=c;this.right=b;this.bottom=a;this.width=this.right-this.left;this.height=this.bottom-this.top};Rect.prototype.isEmpty=function(){return this.width<=0||this.height<=0};Rect.prototype.getCenterX=function(){return(this.left+this.right)/2};Rect.prototype.getCenterY=function(){return(this.top+this.bottom)/2};Rect.prototype.intersects=function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom};Rect.prototype.inset=function(b,a){if(b!=0){this.left+=b;this.right-=b;this.width=this.right-this.left}if(a!=0){this.top+=a;this.bottom-=a;this.height=this.bottom-this.top}};Rect.prototype.translate=function(b,a){this.left+=b;this.right+=b;this.top+=a;this.bottom+=a};Rect.prototype.distanceToPointSquared=function(b,d){var c=0;var a=0;if(d<this.top){a=d-this.top;if(b<this.left){c=b-this.left}else{if(b>this.right){c=b-this.right}}}else{if(d>this.bot){a=d-this.bottom;if(b<this.left){c=b-this.left}else{if(b>this.right){c=b-this.right}}}else{if(b<this.left){c=b-this.left}else{if(b>this.right){c=b-this.right}}}}return(c*c)+(a*a)};Rect.prototype.union=function(a){if(!a){return}if(a.left<this.left){this.left=a.left}if(a.top<this.top){this.top=a.top}this.width=this.right-this.left;if(a.right>this.right){this.right=a.right}if(a.bottom<this.bottom){this.bottom=a.bottom}this.height=this.bottom-this.top};Rect.prototype.adjustedForScreenDensity=function(){if(system&&system.compensateDensity){return new Rect(jsCoordinateToJava(this.left),jsCoordinateToJava(this.top),jsCoordinateToJava(this.right),jsCoordinateToJava(this.bottom))}return this};function isPointInsideRect(a,c,b){return(b.left<=a)&&(a<b.right)&&(b.top<=c)&&(c<b.bottom)}function isRectInsideRect(b,a){return(b.left>=a.left)&&(b.top>=a.top)&&(b.right<=a.right)&&(b.bottom<=a.bottom)}function zoomRect(e,d){var a=new Rect(e.left*d,e.top*d,e.right*d,e.bottom*d);return a;var g=document.body.scrollLeft+e.left*d;var c=g+(e.right-e.left)*d;var f=document.body.scrollTop+e.top*d;var b=f+(e.bottom-e.top)*d;var a=new Rect(g,f,c,b);return a}function getZoomedBoundingClientRect(c,f){var e=null;if(typeof c.getBoundingClientRect=="function"){e=c.getBoundingClientRect();if(e==null){e=new Rect(0,0,0,0)}}else{var h=c.offsetLeft+document.body.scrollLeft;var g=c.offsetTop+document.body.scrollTop;var d=c.offsetWidth;var b=c.offsetHeight;e=new Rect(h,g,h+d,g+b)}if(e==null){e=new Rect(0,0,0,0)}var a=zoomRect(e,f);return a}function getZoomedClientRects(b,h){var i=[];if(b.tagName=="svg"){if(b.offsetParent!=null){var c=b.offsetParent.getBoundingClientRect();var a=b.offsetLeft+c.left;var f=b.offsetTop+c.top;var d=new Rect(a,f,a+b.offsetWidth,f+b.offsetHeight);i.push(zoomRect(d,h))}}else{var g=b.getClientRects();for(var e=0;e<g.length;e++){i.push(zoomRect(g[e],h))}}return i}function jsRectToJava(a){if(system.compensateDensity){return new Rect(jsCoordinateToJava(a.left),jsCoordinateToJava(a.top),jsCoordinateToJava(a.right),jsCoordinateToJava(a.bottom))}else{return a}}function retrieveChildTextNodes(b){var a=createNodeIterator(b,NodeFilter.SHOW_TEXT);var d=[];var c;while((c=a.nextNode())){if(!is_all_ws(c)){d.push(c)}}a.detach();return d}function sanitizeSvgTextNodes(c){var b=c.getElementsByTagName("svg");for(var e=0,g;g=b[e];e++){var f=retrieveChildTextNodes(g);for(var d=0;node=f[d];d++){var a=node.parentNode;if(a.tagName=="SPAN"){a.parentNode.replaceChild(node,a)}}}}var RECTS_LAYER_DIV_ID="rects_layer";var rectsLayerElements=undefined;var triedFetch=false;function drawOutline(d,a,b,h,f){try{var c=document.createElement("div");if(h!=undefined){c.innerHTML=h}if(f!=undefined){c.style.backgroundColor=f}c.style.position="absolute";c.style.top=(Math.floor(d.top)-b+1)+"px";c.style.left=(Math.floor(d.left)-b+1)+"px";c.style.width=Math.floor(d.width)+"px";c.style.height=Math.floor(d.height)+"px";c.style.border=b+"px solid "+a;c.style.zIndex="500";c.style.lineHeight="1 !important;";c.style.fontSize="10px";if(rectsLayerElements==undefined&&!triedFetch){triedFetch=true;rectsLayerElements=document.getElementById(RECTS_LAYER_DIV_ID)}if(rectsLayerElements){rectsLayerElements.appendChild(c)}else{document.body.appendChild(c)}}catch(g){window.bridge.e("Problem during drawOutline(): "+g);return""}}function outlineRects(b,a){for(var c=0;c<b.length;c++){var d=b[c];drawOutline(d,a,1)}}function jsonRectFromRect(b){var a="";if(b!=null){a='{"left":'+(b.left)+', "top": '+(b.top)+', "right": '+(b.right)+', "bottom": '+(b.bottom)+"}"}return a}var WHITESPACE_REGEXP=/^[\s\xa0]*$/;function isWhiteSpace(a){return WHITESPACE_REGEXP.test(a)}function is_all_ws(a){return !(/\S/.test(a.data))}function clamp(c,b,a){if(c<b){return b}else{if(c>a){return a}else{return c}}}function dumpNode(b){window.bridge.d("Elements under "+b+":");var a=createNodeIterator(b,NodeFilter.SHOW_ELEMENT);var e=true;var d;while(d=a.nextNode()){var c="["+d.nodeName;var f=d.getAttribute("id");if(f!=null){c=c.concat(" id="+f)}c=c.concat("]");window.bridge.d(c)}}var IteratorUtils={};IteratorUtils.getNextNode=function(b,a){if(!b){return null}if(b.firstChild){return b.firstChild}while(b&&!b.nextSibling){b=b.parentNode;if(a&&b==a){b=null}}return b?b.nextSibling:null};IteratorUtils.getNextNonEmptyTextNode=function(e){var d=e;while(d=IteratorUtils.getNextNode(d)){if(d.nodeType==Node.TEXT_NODE&&d.nodeValue&&d.nodeValue.length>0){var c=d.nodeValue;var a=c.length;for(var b=0;b<a;b++){if(!isWhiteSpace(c.charAt(b))){return d}}}}return null};IteratorUtils.getPositionForNextNonWhitespace=function(g,a){var e=g.nodeValue;var b=g.length;for(var d=a+1;d<b;d++){if(!isWhiteSpace(e.charAt(d))){return new Position(g,d)}}var c=g;var f=c;while(c=IteratorUtils.getNextNode(c)){if(c.nodeType==Node.TEXT_NODE&&c.nodeValue&&c.nodeValue.length>0){f=c;var e=c.nodeValue;var b=e.length;for(var d=0;d<b;d++){if(!isWhiteSpace(e.charAt(d))){return new Position(c,d)}}}}return new Position(f,f.nodeValue.length)};IteratorUtils.denormalizeOffsetFrom=function(e,i,j,a){var c=e;var b=Math.max(1,i);var f=0;var h,g=0;while((b>0)&&(c=IteratorUtils.getNextNode(c))){if(c.nodeType!=Node.TEXT_NODE){continue}g=0;h=c.nodeValue;while(b>0&&g<h.length){if(!isWhiteSpace(h.charAt(g))){b--}g++;f++}}if(j&&j.skipWhiteSpace&&isDef(h)){while(isWhiteSpace(h.charAt(g))&&g<h.length){g++;f++}}if(g==h.length){var d=c;c=IteratorUtils.getNextNonEmptyTextNode(c);if(c){g=0}else{bridge.e("getNextNonEmptyTextNode returned null");c=d}}if(i<=0){g--;f--}if(a){a.node=c;a.offset=g}return f};IteratorUtils.computeNormalizedOffset=function(h,c,a){var i=h.ownerDocument.createNodeIterator(h,NodeFilter.SHOW_ALL,indexingFilter,false);var b;while(b=i.nextNode()){if(b==c){break}}if(b==null){bridge.e("computeNormalizedOffset could not find textNode "+c)}var f;var j=0;var k=null;while(b=i.previousNode()){var g=b.nodeType;if(g==Node.TEXT_NODE){f=b.nodeValue;var e=(b==c)?Math.min(a,f.length):f.length;var d=0;while(d<e){if(!isWhiteSpace(f.charAt(d))){j++}d++}}else{if(isReadingPositionNode(b)){k=new NormalizedTextPosition(b,j);break}else{}}}i.detach();return k};function getDimensionInPixels(a,d){var c=a.tagName.toLowerCase();var b;if(c=="svg"){b=a.getAttribute(d)}else{b=a[d]}if(!b){return null}if(isNumber(b)){return parseFloat(b)}b=b.trim();if(endsWith(b,"px")){return parseFloat(b)}if(endsWith(b,"%")){return null}if(endsWith(b,"in")){return parseFloat(b)*viewport.xPxPerInch}if(endsWith(b,"cm")){return parseFloat(b)*viewport.xPxPerInch/ViewportConstants.CM_IN_INCH}if(endsWith(b,"mm")){return parseFloat(b)*viewport.xPxPerInch/ViewportConstants.MM_IN_INCH}if(endsWith(b,"pt")){return parseFloat(b)*viewport.xPxPerInch/ViewportConstants.POINTS_IN_INCH}if(endsWith(b,"pc")){return parseFloat(b)*viewport.xPxPerInch/ViewportConstants.PICAS_IN_INCH}return null}function setDimension(a,d,e){var c=a.tagName.toLowerCase();if(c=="svg"){a.style[d]=e+"px"}else{a[d]=e;if(a[d]!=e){var b="max"+d.charAt(0).toUpperCase()+d.substr(1);a.style[b]=e+"px"}}}function viewportBoundedResizeElements(c,g,f,b){var e=c.tagName.toLowerCase();var d=viewport.height;var a=viewport.width;if(e=="svg"){d=Math.floor(d/g);a=Math.floor(a/g)}if(f>d-ViewportConstants.EXTRA_MARGIN||b>a-ViewportConstants.EXTRA_MARGIN){var h=b/f;if(h<viewport.aspectRatio){f=d-ViewportConstants.EXTRA_MARGIN;b=Math.floor(f*h)}else{b=a-ViewportConstants.EXTRA_MARGIN;f=Math.floor(b/h)}setDimension(c,"height",f);setDimension(c,"width",b)}if(e!="svg"){c.style.height=f+"px";c.style.width=b+"px"}}function resizeMediaElementsAfterMainDocumentInsertion(f,g){for(var b=0,a;a=f[b];b++){var d=window.getComputedStyle(a,null);var c=a.offsetHeight-parseFloat(d.paddingTop)-parseFloat(d.paddingBottom);var e=a.offsetWidth-parseFloat(d.paddingRight)-parseFloat(d.paddingLeft);viewportBoundedResizeElements(a,g,c,e)}f.length=0}function retargetUrl(a){var c=a.replace(/&amp;/g,"&");var b=decodeURI(c);return buildResourceContentUri(b)}function isInlineDataUri(a){return startsWith(a.trim(),"data:")}function buildResourceContentUri(a){return window.bridge.getResourceContentUri(a)}function processTableElements(a){var d=a.getElementsByTagName("table");for(var b=0;b<d.length;b++){var c=d[b];var e=getZoomedBoundingClientRect(c,getZoomForTextFromPrefs());if(e.width>viewport.width){c.style.width="100% !important";c.style.tableLayout="fixed !important"}}}function insertSpanAbove_(c){var b=c.parentNode;var a=createElementWithClass(b.ownerDocument,"SPAN");b.replaceChild(a,c);a.appendChild(c)}function processTextNodes(a){var c=retrieveChildTextNodes(a);for(var b=0;node=c[b];b++){insertSpanAbove_(node)}sanitizeSvgTextNodes(a)}function isReadingPositionNode(a){return a.nodeType==Node.ELEMENT_NODE&&a.tagName.toLowerCase()=="a"&&isReadingPosition(a.id)}var indexingFilter={acceptNode:function(c){var b=c.nodeType;var a;if(b==Node.TEXT_NODE){a=NodeFilter.FILTER_ACCEPT}else{if(isReadingPositionNode(c)){a=NodeFilter.FILTER_ACCEPT}else{a=NodeFilter.FILTER_SKIP}}return a}};function getZoomForTextFromPrefs(){var a=pref.textZoom;if(a<=0){a=0.05}return a}function getBoundingTextRect_(d,b){b.setStart(d,0);b.setEnd(d,d.textContent.length);var c=getZoomForTextFromPrefs();var a=getZoomedBoundingClientRect(b,c);return a}function getAncestorWithTagName(d,c,b){var a=d.parentNode;while(a){if(a.tagName==c){return a}if(a==b){return null}a=a.parentNode}return null}function getPartialTextRects(e,i,j){var o=getZoomForTextFromPrefs();var g=e.ownerDocument.createRange();g.setStart(e,i);g.setEnd(e,j);var p=getZoomedClientRects(g,o);var f=g.startContainer;var k=f==g.endContainer;g.detach();if(k){var a=getAncestorWithTagName(f,"RUBY");if(a){var m=getAncestorWithTagName(f,"RT",a);if(m){return[]}var l=a.ownerDocument.defaultView.getComputedStyle(a,null).WebkitWritingMode;if(l=="vertical-rl"){var h=getZoomedBoundingClientRect(a,o);var d=[];for(var n=0;n<p.length;n++){var c=p[n];var b=new Rect(h.left,c.top,h.right,c.bottom);d.push(b)}return d}}}else{bridge.e("Warning! getPartialTextRects range spans multiple nodes. "+"May return invalid ruby element rects.")}return p}function getTextRectsForRange(m,q,d){var n=m;var f=q;var r=d;var h=[];var p=createNodeIterator(n,NodeFilter.SHOW_TEXT);var a=0;while(child=p.nextNode()){var k=child.nodeValue;var c=k.length;var j=a;var b=a+c;if(f<=b&&r>=j){var e=f-a;var e=clamp(e,0,c);var s=r-a;var s=clamp(s,0,c);var l=getPartialTextRects(child,e,s);var g=l.length;for(var o=0;o<g;o++){h.push(l[o])}}else{if(j>r){break}}a+=c}p.detach();return h}function stripQuotes(a){return a.replace(/^['"]/,"").replace(/['"]$/,"")}function playVideo(b,d){var a=volume.chapters[b];var c=a.element.ownerDocument.getElementById(d);if(c!=null){if(c.ended||c.paused){c.play()}else{c.pause()}}}function setIframeHeight(a){if(a){var b=a.contentWindow||a.contentDocument.parentWindow;if(b.document.body){a.height=(b.document.documentElement.scrollHeight||b.document.body.scrollHeight)+"px"}}}function get_selection(){var a=undefined;if(document.getSelection){a=document.getSelection()}else{if(document.selection&&document.selection.createRange()){a=document.selection.createRange().text}else{if(window.getSelection){a=window.getSelection()}}}return a}function remove_selection(){if(window.getSelection){var b=window.getSelection();b.removeAllRanges()}else{if(document.selection.createRange){var a=document.selection.createRange();document.selection.empty()}}}function IsiPhone(){var a=navigator.userAgent.match(/(iPhone|iPod).*(AppleWebKit|Safari)/)?121:0;return a}function IsiPad(){var a=navigator.userAgent.match(/iPad.*(AppleWebKit|Safari)/)?1:0;return a}function IsAndroid(){return(navigator.userAgent.search(/android/i)>-1)}function getBrowserInfo(){var f={ie:false,firefox:false,opera:false,chrome:false,safari:false,version:0,name:"undef"};var d=navigator.userAgent.match(/(Chrome|Safari|Opera|Firefox)\/([\d\.]+)/i);if(d){var c=d[1].toLowerCase();var e=navigator.userAgent.match(/Version\/([\d\.]+)/i);f[c]=true;f.name=c;f.version=e?e[1]:d[2]}else{if(d=navigator.userAgent.match(/(MSIE)\s+([\d\.]+)/i)){f["msie"]=true;f.name="msie";f.version=d[2]}}return f};